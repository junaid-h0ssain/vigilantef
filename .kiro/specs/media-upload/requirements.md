# Requirements Document

## Introduction

This feature enables users to upload images and videos directly from their devices when creating crime reports, replacing the current URL-based approach. The system will handle file uploads to Firebase Storage and store the resulting URLs in Firestore, providing a seamless media attachment experience for community reporting.

## Glossary

- **Media Upload System**: The component responsible for handling file selection, validation, upload to Firebase Storage, and URL management
- **Firebase Storage**: Google's cloud storage service for storing user-uploaded files
- **Post**: A crime report submitted by a user containing text information and optional media attachments
- **Storage Reference**: A pointer to a file location in Firebase Storage
- **Download URL**: A publicly accessible URL generated by Firebase Storage for accessing uploaded files
- **File Validation**: The process of checking file type, size, and format before upload
- **Upload Progress**: Real-time feedback showing the percentage of file data transferred

## Requirements

### Requirement 1

**User Story:** As a user, I want to upload images from my device when creating a report, so that I can provide visual evidence without needing to host images elsewhere.

#### Acceptance Criteria

1. WHEN a user clicks the image upload button THEN the system SHALL open a file picker dialog filtered to image file types
2. WHEN a user selects an image file THEN the system SHALL validate the file is an accepted image format (JPEG, PNG, GIF, WebP)
3. WHEN a user selects an image file THEN the system SHALL validate the file size does not exceed 5 megabytes
4. WHEN an image passes validation THEN the system SHALL upload the file to Firebase Storage under the path "posts/images/{userId}/{timestamp}_{filename}"
5. WHEN an image upload completes THEN the system SHALL store the download URL in the post document

### Requirement 2

**User Story:** As a user, I want to upload videos from my device when creating a report, so that I can provide video evidence without needing to host videos elsewhere.

#### Acceptance Criteria

1. WHEN a user clicks the video upload button THEN the system SHALL open a file picker dialog filtered to video file types
2. WHEN a user selects a video file THEN the system SHALL validate the file is an accepted video format (MP4, WebM, MOV)
3. WHEN a user selects a video file THEN the system SHALL validate the file size does not exceed 50 megabytes
4. WHEN a video passes validation THEN the system SHALL upload the file to Firebase Storage under the path "posts/videos/{userId}/{timestamp}_{filename}"
5. WHEN a video upload completes THEN the system SHALL store the download URL in the post document

### Requirement 3

**User Story:** As a user, I want to see upload progress when uploading media files, so that I know the upload is working and can estimate completion time.

#### Acceptance Criteria

1. WHEN a file upload begins THEN the system SHALL display a progress indicator showing percentage complete
2. WHILE a file is uploading THEN the system SHALL update the progress indicator in real-time
3. WHEN a file upload completes successfully THEN the system SHALL display a success message with a preview of the uploaded media
4. WHEN a file upload fails THEN the system SHALL display an error message explaining the failure reason
5. WHILE a file is uploading THEN the system SHALL disable the submit button to prevent premature form submission

### Requirement 4

**User Story:** As a user, I want to preview uploaded media before submitting my report, so that I can verify I selected the correct files.

#### Acceptance Criteria

1. WHEN an image upload completes THEN the system SHALL display a thumbnail preview of the image
2. WHEN a video upload completes THEN the system SHALL display a video player preview with playback controls
3. WHEN viewing a media preview THEN the system SHALL provide a remove button to delete the uploaded file
4. WHEN a user clicks the remove button THEN the system SHALL delete the file from Firebase Storage and clear the preview
5. WHEN a user removes uploaded media THEN the system SHALL re-enable the upload button for that media type

### Requirement 5

**User Story:** As a user, I want to view uploaded images and videos in existing posts, so that I can see the evidence provided by other community members.

#### Acceptance Criteria

1. WHEN a post contains an uploaded image THEN the system SHALL display the image inline within the post card
2. WHEN a post contains an uploaded video THEN the system SHALL display a video player with playback controls within the post card
3. WHEN an image fails to load THEN the system SHALL display a placeholder indicating the image is unavailable
4. WHEN a video fails to load THEN the system SHALL display a placeholder indicating the video is unavailable
5. WHEN displaying media THEN the system SHALL apply responsive sizing to ensure proper display on all screen sizes

### Requirement 6

**User Story:** As a system administrator, I want uploaded files to be organized and secured in Firebase Storage, so that the storage remains manageable and user data is protected.

#### Acceptance Criteria

1. WHEN files are uploaded THEN the system SHALL organize them in a hierarchical structure by media type and user ID
2. WHEN files are uploaded THEN the system SHALL generate unique filenames using timestamps to prevent collisions
3. WHEN accessing uploaded files THEN the system SHALL enforce Firebase Storage security rules requiring authentication
4. WHEN a file upload is initiated THEN the system SHALL verify the user is authenticated before proceeding
5. WHEN storage operations fail THEN the system SHALL log errors with sufficient detail for debugging

### Requirement 7

**User Story:** As a user, I want clear error messages when file uploads fail, so that I understand what went wrong and how to fix it.

#### Acceptance Criteria

1. WHEN a file exceeds the size limit THEN the system SHALL display an error message stating the maximum allowed size
2. WHEN a file has an unsupported format THEN the system SHALL display an error message listing the accepted formats
3. WHEN a network error occurs during upload THEN the system SHALL display an error message suggesting the user check their connection
4. WHEN a user is not authenticated THEN the system SHALL display an error message requiring login before upload
5. WHEN a storage quota is exceeded THEN the system SHALL display an error message indicating storage limits have been reached
